var ztools={apply:function(b,c,a){if((typeof b)=="function"){return b.apply(b,c?c:[])}return a}};var iscollback=false;var isleafcollback=false;var rootUrl;var title;var width;var height;var treeId;var treeType;var showContent;var noDeparmentUser;var onlineVisible;var multiObj={};var chkStyle;var treeNodeData;var chkboxType;var departmentShow;var leafEnable;var multiLeafJson;var feedbackEnable;var showInput;var showThing;var hiddenInput;var hiddenThing;var append;var branchIds;var callback;var myztreeObj={pCheckNodeList:"",pCheckUserNodeList:"",pCheckDeparmentNodeList:"",pCheckWorkgroupNodeList:"",pCurrentCheckedNode:"",pCurrentClickNode:"",pCurrentClickParentNode:"",checkAll:""};var API=[{myObj:{pCheckNodeList:myztreeObj.pCheckNodeList,pCurrentCheckedNode:myztreeObj.pCurrentCheckedNode},single:{getCurrentClickNode:function(){return myztreeObj.pCurrentClickNode},getCurrentClickParentNode:function(){return myztreeObj.pCurrentClickParentNode},getCurrentClickNodeId:function(){return myztreeObj.pCurrentClickNode.id.split("_")[1]},getCurrentClickNodeParentId:function(){return myztreeObj.pCurrentClickNode.pId.split("_")[1]},getCurrentClickNodeName:function(){return myztreeObj.pCurrentClickNode.name},getCurrentClickNodeType:function(){return myztreeObj.pCurrentClickNode.type},getCurrentClickNodeData:function(){return myztreeObj.pCurrentClickNode.data},getClickValueByNode:function(param){var currentClickNode=myztreeObj.pCurrentClickNode;eval("obj="+currentClickNode.data);if(obj){return obj[param]}else{return""}}}}];function popLeafZtree(j){var w="";var m="";var g="";var a="";var r="";var p="";var d="";var s="";var u="";var o="";var t="";var k="";var c="";var h=j.leafs;if(!h){alert("\u8bf7\u914d\u7f6e\u9875\u7b7e!");return}var c=j.callback.onClose;if(j.view){w=j.view.title;m=j.view.width;g=j.view.height;a=j.view.url;r=j.view.showBranch;p=j.view.noDeparmentUser;d=j.view.onlineVisible;s=j.view.branchIds}if(j.feedback){u=j.feedback.showInput;o=j.feedback.hiddenInput;t=j.feedback.showThing;k=j.feedback.hiddenThing}if(j.callback){c=j.callback.onClose}var e="[";for(var q=0,n=h.length;q<n;q++){var f="{";for(var v in h[q]){f=f+v+":'"+h[q][v]+"',"}if(f.indexOf(",")!=-1){f=f.substring(0,f.length-1)}f=f+"}";e=e+f+(q==n-1?"]":",")}var b=a+"/portal/ztree-pop.action?userWithoutDeptVisible="+p+"&onlineVisible="+d+"&showInput="+u+"&showThing="+t+"&hiddenInput="+o+"&hiddenThing="+k+"&showBranch="+r+"&branchIds="+s+"&leafsMsg="+e;$.colorbox({href:encodeURI(b),iframe:true,innerWidth:m,innerHeight:g,overlayClose:false,title:w,onClosed:function(){if(isleafcollback){ztools.apply(c,API,c);isleafcollback=false}}});return API}function popZtree(b){if(b.view){rootUrl=b.view.url;title=b.view.title;width=b.view.width;height=b.view.height;showBranch=b.view.showBranch}if(b.data){branchIds=b.data.branchIds;chkStyle=b.data.chkStyle;chkboxType=b.data.chkboxType;if(chkboxType){if(chkboxType.constructor==Object){chkboxType="{'Y' : '"+((chkboxType.Y||chkboxType.y)?(chkboxType.Y||chkboxType.y):"")+"', 'N' : '"+((chkboxType.Y||chkboxType.y)?(chkboxType.Y||chkboxType.y):"")+"'}"}}treeNodeData=ztools.apply(b.data.treeNodeData,"",b.data.treeNodeData);departmentShow=ztools.apply(b.data.departmentShow,"",b.data.departmentShow)}if(b.type){treeType=b.type.treeType;treeId=b.type.treeId;if(!title||title==""){if(treeType=="COMPANY"){title="\u516c\u53f8\u6811"}else{if(treeType=="MAN_DEPARTMENT_TREE"){title="\u90e8\u95e8\u4eba\u5458\u6811"}else{if(treeType=="MAN_GROUP_TREE"){title="\u5de5\u4f5c\u7ec4\u4eba\u5458\u6811"}else{if(treeType=="DEPARTMENT_TREE"){title="\u90e8\u95e8\u6811"}else{if(treeType=="GROUP_TREE"){title="\u5de5\u4f5c\u7ec4\u6811"}else{if(treeType=="DEPARTMENT_WORKGROUP_TREE"){title="\u90e8\u95e8\u5de5\u4f5c\u7ec4\u6811"}}}}}}}showContent=ztools.apply(b.type.showContent,"",b.type.showContent);noDeparmentUser=b.type.noDeparmentUser;onlineVisible=b.type.onlineVisible}if(b.leaf){leafEnable=b.leaf.enable;multiLeafJson=ztools.apply(b.leaf.multiLeafJson,"",b.leaf.multiLeafJson)}if(b.feedback){feedbackEnable=b.feedback.enable;showInput=b.feedback.showInput;showThing=ztools.apply(b.feedback.showThing,"",b.feedback.showThing);hiddenInput=b.feedback.hiddenInput;hiddenThing=ztools.apply(b.feedback.hiddenThing,"",b.feedback.hiddenThing);append=b.feedback.append}callback=b.callback.onClose;var c=rootUrl+"/portal/ztree-pop.action?treeType="+treeType+"&chkStyle="+chkStyle+"&treeNodeData="+treeNodeData+"&chkboxType="+chkboxType+"&treeNodeShowContent="+showContent+"&userWithoutDeptVisible="+noDeparmentUser+"&onlineVisible="+onlineVisible+"&leafEnable="+leafEnable+"&multiLeafJson="+multiLeafJson+"&feedbackEnable="+feedbackEnable+"&showInput="+showInput+"&showThing="+showThing+"&hiddenInput="+hiddenInput+"&hiddenThing="+hiddenThing+"&append="+append+"&departmentShow="+departmentShow+"&showBranch="+showBranch+"&branchIds="+branchIds+"&treeId="+treeId;var a=b.callback.handClose;$.colorbox({href:encodeURI(c),iframe:true,innerWidth:width,innerHeight:height,overlayClose:false,title:title,onClosed:function(){if(iscollback){ztools.apply(callback,API,callback);iscollback=false}else{ztools.apply(a,"",a)}}});return API}var myZtree={clearInput:function(){if(typeof(showInput)=="undefined"||showInput==""){return}$("#"+showInput).attr("value","");if(typeof(hiddenInput)=="undefined"||hiddenInput==""){return}$("#"+hiddenInput).attr("value","")},deleteInput:function(f){if(typeof(showInput)=="undefined"||showInput==""){return}var e=getCachFromCookieByKey("showCachContent"+showInput);if(typeof(hiddenInput)=="undefined"||hiddenInput==""){return}var d=getCachFromCookieByKey("hiddenCachContent"+hiddenInput);if(e==""){alert("\u663e\u793a\u7f13\u5b58\u4e3a\u7a7a!");return}if(d==""){alert("\u9690\u85cf\u7f13\u5b58\u4e3a\u7a7a!");return}if(!isAvailable(e,d)){alert("\u663e\u793a\u7684\u683c\u5f0f\u548c\u9690\u85cf\u57df\u683c\u5f0f\u8bbe\u7f6e\u4e0d\u4e00\u81f4!");return}var c=createJson(e,d);var b=$("#removeStaffJson").val();if(typeof(b)=="undefined"){$("#"+f).append("<input type='hidden' id='removeStaffJson' name='removeStaffJson' value='"+c+"'/> ")}else{$("#removeStaffJson").attr("value",c)}var a=rootUrl+"/portal/remove-ztree.action?showInput="+showInput+"&hiddenInput="+hiddenInput;$.colorbox({href:encodeURI(a),iframe:true,innerWidth:400,innerHeight:400,overlayClose:false,title:"\u79fb\u9664",onClosed:function(){}})}};function getCachFromCookieByKey(e){var a="";var f=unescape(document.cookie).split(";");for(var d=0;d<f.length-1;d++){var c=f[d].split("=")[0];var b=f[d].split("=")[1];if($.trim(c)==$.trim(e)){a=b}}return a}function createJson(e,l){var f=e.split("+");var b=l.split("+");var k="[";for(var d=0;d<f.length;d++){var h=$.trim(f[d].split(":")[0]);var g=f[d].split(":")[1].split(",");var a=b[d].split(":")[1].split(",");if(h=="user"){for(var c=0;c<g.length;c++){k=k+'{"type":"user","showValue":"'+g[c]+'","hiddenValue":"'+a[c]+'"},'}}else{if(h=="department"){for(var c=0;c<g.length;c++){k=k+'{"type":"department","showValue":"'+g[c]+'","hiddenValue":"'+a[c]+'"},'}}else{if(h=="workgroup"){for(var c=0;c<g.length;c++){k=k+'{"type":"workgroup","showValue":"'+g[c]+'","hiddenValue":"'+a[c]+'"},'}}}}}k=k.substring(0,k.length-1)+"]";return k}function isAvailable(d,c){var a=true;var e=d.split("+");var b=c.split("+");if(e.length!=b.length){a=false}if(d.indexOf("user:")!=-1&&c.indexOf("user:")==-1){a=false}if(c.indexOf("user:")!=-1&&d.indexOf("user:")==-1){a=false}if(d.indexOf("department:")!=-1&&c.indexOf("department:")==-1){a=false}if(c.indexOf("department:")!=-1&&d.indexOf("department:")==-1){a=false}if(d.indexOf("workgroup:")!=-1&&c.indexOf("workgroup:")==-1){a=false}if(c.indexOf("workgroup:")!=-1&&d.indexOf("workgroup:")==-1){a=false}return a}function getMsgById(a,b){if(multiObj[a]){if(multiObj[a][b]){return multiObj[a][b]}}return""}var ztree={getCurrentClickNode:function(){return API[0].single.getCurrentClickNode()},getId:function(){return API[0].single.getClickValueByNode("id")},getName:function(){return API[0].single.getClickValueByNode("name")},getLoginName:function(){return API[0].single.getClickValueByNode("loginName")},getDepartmentName:function(){return API[0].single.getClickValueByNode("name")},getDepartmentId:function(){return API[0].single.getClickValueByNode("id")},getWorkGroupName:function(){return API[0].single.getClickValueByNode("name")},getWorkGroupId:function(){return API[0].single.getClickValueByNode("id")},getEmail:function(){return API[0].single.getClickValueByNode("email")},getWeight:function(){return API[0].single.getClickValueByNode("weight")},getUserDepartmentName:function(){return API[0].single.getClickValueByNode("subCompanyId")},getSubCompanyId:function(){return API[0].single.getClickValueByNode("subCompanyId")},getSubCompanyName:function(){return API[0].single.getClickValueByNode("subCompanyName")},getDepartmentCode:function(){return API[0].single.getClickValueByNode("code")},getDepartmentShortTitle:function(){return API[0].single.getClickValueByNode("shortTitle")},getIds:function(){return getMsgById("user","id")},getNames:function(){return getMsgById("user","name")},getLoginNames:function(){return getMsgById("user","loginName")},getSubCompanyIds:function(){return getMsgById("user","subCompanyId")},getEmails:function(){return getMsgById("user","mail")},getTelephones:function(){return getMsgById("user","telephone")},getDepartmentNames:function(){return getMsgById("department","name")},getDepartmentIds:function(){return getMsgById("department","id")},getDepartmentCodes:function(){return getMsgById("department","code")},getDepartmentShortTitles:function(){return getMsgById("department","shortTitle")},getWorkGroupNames:function(){return getMsgById("workgroup","name")},getWorkGroupIds:function(){return getMsgById("workgroup","id")}};
